{% extends "base.html" %}
{% load i18n rules %}

{% block content %}
<div class="text-sm flex items-center mb-3">
  <a href="{% url 'projects:projects_overview' %}"
     class="text-blue-800 hover:text-blue-600 mr-2">Projects</a>
  <span class="text-gray-500 mr-2">&gt;</span>
  <a href="{{ card.project.get_absolute_url }}"
     class="text-blue-800 hover:text-blue-600 mr-2">
    {{ card.project.name }}
  </a>
  <span class="text-gray-500 mr-2">&gt;</span>
  <span class="text-gray-500">{{ card.name }}</span>
</div>

{% has_perm "cards.create_card" user card.project as can_create_card %}
{% has_perm "cards.change_card" user card as can_change_card %}
{% has_perm "cards.delete_card" user card as can_delete_card %}
{% has_perm "tasks.create_task" user card as can_create_task %}

<div class="flex items-center justify-between mb-3">
  <h1 class="text-xl font-bold">{{ card.name }}</h1>
  {% if can_create_card or can_change_card or can_delete_card %}
  <div class="relative"
       data-controller="toggle">
    <button class="px-2 py-1 rounded border hover:bg-gray focus:outline-none text-lg"
            title="Actions..."
            data-action="toggle#toggle">
      <i class="fa fa-bars"></i>
    </button>
    <div class="rounded absolute hidden border shadow-xl z-50 opacity-100 p-3 mt-1 w-64 bg-white right-0"
         data-target="toggle.item"
         data-action="click@window->toggle#close keydown@window->toggle#close">

      {% if can_create_card %}
      <a href="{% url 'cards:create_card_for_column' card.project.id card.column.id %}"
         class="block p-1 rounded hover:bg-gray-100 w-full mb-2">
        <i class="fa fa-plus mr-2"></i>{% translate "Add Another Card" %}
      </a>
      {% endif %}

      {% if can_create_task %}
      <a href="{% url 'tasks:create_task' card.id %}"
         class="block p-1 rounded hover:bg-gray-100 w-full mb-2">
        <i class="fa fa-plus mr-2"></i>{% translate "Add New Task" %}
      </a>
      {% endif %}

      {% if can_change_card %}
      <a href="{% url 'cards:edit_card' card.id %}"
         class="block p-1 rounded hover:bg-gray-100 w-full mb-2">
        <i class="fa fa-pen mr-2"></i>{% translate "Edit Card" %}
      </a>
      {% endif %}

      {% if can_delete_card %}
      <button data-controller="ajax"
              data-ajax-confirm="{% translate 'Are you sure you want to delete this card?' %}"
              data-ajax-url="{% url 'cards:delete_card' card.id %}"
              data-action="toggle#toggle ajax#post"
              class="block p-1 rounded hover:bg-red-100 text-red-800 w-full text-left">
        <i class="fa fa-trash mr-2"></i>{% translate "Delete Card" %}
      </button>
      {% endif %}

    </div>
  </div>
  {% endif %}

</div>

<div class="flex items-center mb-3">
  <div class="mr-2 font-bold">{% translate "Priority" %}</div>
  <div class="mr-2">{{ card.priority }}</div>
  <div class="mr-2 font-bold">{% translate "Complexity" %}</div>
  <div class="mr-2">{{ card.complexity }}</div>
  <div class="mr-2 font-bold">{% translate "Estimated Hours" %}</div>
  <div class="">{{ card.hours_estimated }}</div>
</div>

{% if card.description %}
<p class="bg-gray-100 rounded p-2">
  {{ card.description|linebreaksbr }}
</p>
{% endif %}

{% if tasks %}
<h2 class="text-lg font-semibold mb-3">{% translate "Tasks" %}</h2>
<div data-controller="drag"
     data-drag-group="shared">
  {% for task in tasks %}
  <div class="border mb-3 p-2 sm:flex items-center hover:bg-gray-100 justify-between draggable"
       data-id="{{ task.id }}"
       data-target="drag.draggable">
    <div class="flex items-center">
      <input type="checkbox"
             {% if task.completed %}
             checked{% endif %}
             class="mr-4 h-4 w-4">
      <span>
        {{ task.description }}
      </span>
    </div>
    <div>
      <a href=""
         class="border px-4 py-1 rounded hover:bg-gray-100 w-full mr-2">
        <i class="fa fa-pen mr-2"></i>{% translate "Edit" %}
      </a>
      <a href=""
         class="border border-red-800 px-4 py-1 rounded hover:bg-red-100 w-full mb-2 text-red-800">
        <i class="fa fa-trash mr-2"></i>{% translate "Delete" %}
      </a>
    </div>
  </div>
  {% endfor %}
</div>
{% endif %}
{% endblock content %}
